define(["jquery","core/log","core/ajax","core/templates","core/str"],function(l,o,e,n,t){"use strict";function r(e){var t=this;t.rootel=e,t.component="mod_psgrading",t.templates={CRITERION:"mod_psgrading/rubric_selector_criterionform"}}return r.prototype.main=function(){var t=this;t.rootel.on("click","#btn-addcriterion",function(e){e.preventDefault(),t.add()});var e=[];e.push(t.loadTemplate("CRITERION")),l.when.apply(l,e).then(function(){t.rootel.addClass("preloads-completed")})},r.prototype.add=function(){var t=this;o.debug(t.templates.CRITERION),n.render(t.templates.CRITERION,{}).done(function(e){t.rootel.find(".criterions").append(e)})},r.prototype.remove=function(e){for(var t=e.data("taguid"),r=l('input[name="recipientjson"]'),o=JSON.parse(r.val()),n=new Array,i=0;i<o.length;i++){o[i].taguid!=t&&n.push(o[i])}var a="";n.length&&(a=JSON.stringify(n)),r.val(a),e.remove()},r.prototype.render=function(){var t=this;t.rootel.removeClass("has-tags");var e=l('input[name="recipientjson"]').val(),r=[];e&&(r=JSON.parse(e)),r.length?(e=[],e=t.allowmultiple?{tags:r}:{tags:r.pop()},n.render("mod_psgrading/recipient_selector_tags",e).then(function(e){t.rootel.find(".rubric-selection").html(e),t.rootel.addClass("has-tags"),t.rootel.removeClass("adding-tag"),t.rootel.find(".rubric-autocomplete").val("")}).fail(function(e){o.error(e)})):t.rootel.find(".rubric-selection").html(t.strings.noselectionstr)},r.prototype.loadTemplate=function(e){return n.render(this.templates[e],{})},{init:function(){o.debug("mod_psgrading/rubricselector: initializing the rubric-selector component");var e=l(".rubric-selector").first();if(e.length){e=new r(e);return e.main(),e}o.error("mod_psgrading/rubricselector: rubric-selector root element not found!")}}});