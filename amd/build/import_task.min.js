define(["core/ajax","core/log","core/templates"],function(r,e,a){function d(){var e=this;e.courseSelection=document.getElementById("id_courseswithpsgrading"),e.courseSelectionJSON=document.getElementById("id_selectedcourseJSON").value,e.taskSelectedJSON=document.getElementById("id_selectedtasksJSON").value}return d.prototype.main=function(){this.initEventListeners()},d.prototype.initEventListeners=function(){this.courseSelection.addEventListener("change",this.findPSActivitiesInCourse.bind(this))},d.prototype.findPSActivitiesInCourse=function(e){JSON.parse(this.courseSelectionJSON);for(var t=[],i=0;i<this.courseSelection.options.length;i++)this.courseSelection.options[i].selected&&t.push(this.courseSelection.options[i].value);this.courseSelectionJSON=JSON.stringify(t),document.getElementById("id_selectedcourseJSON").value=this.courseSelectionJSON,this.getPSActivitiesInCourses()},d.prototype.getPSActivitiesInCourses=function(){var i=this;r.call([{methodname:"mod_psgrading_get_activities_in_course",args:{data:this.courseSelectionJSON},done:function(e){e=JSON.parse(e.templatecontext);console.log(e);e={activities:e.activities,size:e.size,cmids:e.cmids};a.render("mod_psgrading/import_task_activities",e).then(function(e,t){a.replaceNodeContents(".psgrading-import-task-modules-in-selected-course",e,t),i.setListenerForActivities()}).catch(function(e){console.error("Error rendering template:",e)})},fail:function(e){console.log(e)}}])},d.prototype.setListenerForActivities=function(){document.getElementById("id_activitiesincourseselected").addEventListener("change",this.findTasks.bind(this))},d.prototype.findTasks=function(e){for(var t,i=this,s=JSON.parse(e.target.getAttribute("data-cmids")),n=[],o=document.getElementById("id_activitiesincourseselected"),c=0;c<o.options.length;c++){o.options[c].selected&&(t=o.options[c].value,n.push(s[t]))}r.call([{methodname:"mod_psgrading_get_tasks_in_activity",args:{data:JSON.stringify(n)},done:function(e){e=JSON.parse(e.templatecontext);console.log(e);e={id:e.id,tasks:e.tasks,size:e.size};a.render("mod_psgrading/import_task_tasks_in_activity",e).then(function(e,t){a.replaceNodeContents(".psgrading-import-task-tasks-in-selected-activity",e,t),i.setListenerForTasks()}).catch(function(e){console.error("Error rendering template:",e)})},fail:function(e){console.log(e)}}]),d.prototype.setListenerForTasks=function(){document.getElementById("id_tasksinselectedactivity").addEventListener("change",this.taskselected.bind(this))},d.prototype.taskselected=function(e){for(var t=JSON.parse(this.taskSelectedJSON),i=[],s=document.getElementById("id_tasksinselectedactivity"),n=0;n<s.options.length;n++)s.options[n].selected&&i.push(s.options[n].value);t=i,console.log(i),this.taskSelectedJSON=JSON.stringify(t),document.getElementById("id_selectedtasksJSON").value=this.taskSelectedJSON}},{init:function(){e.debug("mod_psgrading/import_task: initialising"),(new d).main()}}});