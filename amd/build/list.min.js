define(["jquery","core/log","core/ajax"],function(e,o,a){"use strict";function n(t){this.rootel=t}return n.prototype.main=function(){var t,n=this;n.rootel.on("click",".action-release",function(t){t.preventDefault();t=e(this);n.releaseTask(t)}),n.rootel.on("click",".action-undorelease",function(t){t.preventDefault();t=e(this);n.unreleaseTask(t)}),n.rootel.on("click",".action-discarddraft",function(t){t.preventDefault();t=e(this);n.deleteDraft(t)}),"undefined"!=typeof Sortable&&(t=document.getElementById("task-list"),new Sortable(t,{handle:".btn-reorder",animation:150,ghostClass:"reordering",onEnd:n.SortEnd}))},n.prototype.deleteDraft=function(t){t=t.closest(".task");a.call([{methodname:"mod_psgrading_apicontrol",args:{action:"delete_draft",data:t.data("id")},done:function(){window.location.reload(!1)},fail:function(t){o.debug(t)}}])},n.prototype.releaseTask=function(t){t=t.closest(".task");a.call([{methodname:"mod_psgrading_apicontrol",args:{action:"release_task",data:t.data("id")},done:function(){window.location.reload(!1)},fail:function(t){o.debug(t)}}])},n.prototype.unreleaseTask=function(t){t=t.closest(".task");a.call([{methodname:"mod_psgrading_apicontrol",args:{action:"unrelease_task",data:t.data("id")},done:function(){window.location.reload(!1)},fail:function(t){o.debug(t)}}])},n.prototype.SortEnd=function(t){var n=new Array;e("#task-list .task").each(function(){n.push(e(this).data("id"))}),a.call([{methodname:"mod_psgrading_apicontrol",args:{action:"reorder_tasks",data:JSON.stringify(n)},done:function(){},fail:function(t){o.debug(t)}}])},{init:function(){o.debug("mod_psgrading/list: initializing");var t=e("#page-mod-psgrading-view");t.length?new n(t).main():o.error("mod_psgrading/list: #page-mod-psgrading-view not found!")}}});