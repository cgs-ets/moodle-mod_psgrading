define(["jquery","core/log","core/ajax"],function(a,e,i){"use strict";function t(n){this.rootel=n}return t.prototype.main=function(){var n,t=this;t.rootel.on("click",".btn-release",function(n){n.preventDefault();n=a(this);n.hasClass("submitting")||(n.addClass("submitting"),n.html('<div class="spinner"><div class="circle spin"></div></div>'),t.releaseTask(n))}),t.rootel.on("click",".btn-undorelease",function(n){n.preventDefault();n=a(this);n.hasClass("submitting")||(n.addClass("submitting"),n.html('<div class="spinner"><div class="circle spin"></div></div>'),t.unreleaseTask(n))}),"undefined"!=typeof Sortable&&(n=document.getElementById("task-list"),new Sortable(n,{handle:".btn-reorder",animation:150,ghostClass:"reordering",onEnd:t.SortEnd}))},t.prototype.releaseTask=function(n){n=n.closest(".task");i.call([{methodname:"mod_psgrading_apicontrol",args:{action:"release_task",data:n.data("id")},done:function(){window.location.reload(!1)},fail:function(n){e.debug(n)}}])},t.prototype.unreleaseTask=function(n){n=n.closest(".task");i.call([{methodname:"mod_psgrading_apicontrol",args:{action:"unrelease_task",data:n.data("id")},done:function(){window.location.reload(!1)},fail:function(n){e.debug(n)}}])},t.prototype.SortEnd=function(n){var t=new Array;a("#task-list .task").each(function(){t.push(a(this).data("id"))}),i.call([{methodname:"mod_psgrading_apicontrol",args:{action:"reorder_tasks",data:JSON.stringify(t)},done:function(){},fail:function(n){e.debug(n)}}])},{init:function(){e.debug("mod_psgrading/list: initializing");var n=a("#page-mod-psgrading-view");n.length?new t(n).main():e.error("mod_psgrading/list: #page-mod-psgrading-view not found!")}}});