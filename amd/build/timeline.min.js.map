{"version":3,"sources":["../src/timeline.js"],"names":["define","$","Log","Config","Ajax","Templates","Str","ModalFactory","ModalEvents","RecipientSelector","Timeline","rootel","self","component","overlay","templates","SLIDER","EXPORTRESULT","modals","prototype","main","on","e","preventDefault","button","display","tag","window","location","href","data","expandReply","postReply","cancelReply","reply","closest","addClass","find","focus","postThreadReply","displaySlide","stopPropagation","navSlider","slider","closeSlider","delete","deleteReply","expandRecipients","showReplyToRecipients","changeReplyToRecipient","showConversation","export","getModal","hide","InfiniteScroll","path","append","history","status","init","removeClass","preloads","loadModal","types","DEFAULT","when","apply","then","index","className","match","join","post","comment","val","trim","length","postid","postsusersid","replytoselected","attr","call","methodname","args","done","response","loadReplies","fail","reason","error","debug","dropdown","replyid","justcreated","first","replies","timelineuser","replaceWith","html","hasClass","username","conversation","click","conversations","thumb","slides","each","slide","current","images","i","src","isimage","isvideo","isdoc","iconimage","filename","mimetype","iscurrent","push","count","render","direction","currentid","newid","newslide","approve","id","fadeOut","remove","threadid","depth","replytorecipient","recipients","next","fadeIn","replyto","selected","slideUp","conversationusername","creatorreplies","modalkey","title","buttontext","type","create","modal","setTitle","setSaveButtonText","getBackdrop","getRoot","timeline","code","existinginprogress","existingready","downloadurl","ready","setBody","show","loadTemplate","templatekey","rootselector"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * @package   mod_psgrading\r\n * @copyright 2020 Michael Vangelovski\r\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\n\r\ndefine(['jquery', 'core/log', 'core/config', 'core/ajax','core/templates', \r\n        'core/str', 'core/modal_factory', 'core/modal_events', 'mod_psgrading/recipientselector' ], \r\n        function($, Log, Config, Ajax, Templates, Str, ModalFactory, ModalEvents, RecipientSelector) {    \r\n    'use strict';\r\n\r\n    /**\r\n     * Initializes the component.\r\n     */\r\n    function init(rootselector) {\r\n        Log.debug('mod_psgrading/timeline: initializing');\r\n\r\n        var rootel = $(rootselector).first();\r\n\r\n        if (!rootel.length) {\r\n            Log.error('mod_psgrading/timeline: ' + rootselector + ' element not found!');\r\n            return;\r\n        }\r\n\r\n        var timeline = new Timeline(rootel);\r\n        timeline.main();\r\n    }\r\n\r\n    /**\r\n     * The constructor\r\n     *\r\n     * @constructor\r\n     * @param {jQuery} rootel\r\n     */\r\n    function Timeline(rootel) {\r\n        var self = this;\r\n        self.rootel = rootel;\r\n        self.component = 'mod_psgrading';\r\n        self.overlay = $('#psgrading-overlay');\r\n\r\n        self.templates = {\r\n            SLIDER: 'mod_psgrading/slider',\r\n            EXPORTRESULT: 'mod_psgrading/export_result',\r\n        };\r\n        self.modals = {\r\n            EXPORTRESULT: null,\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Run the Audience Selector.\r\n     *\r\n     */\r\n    Timeline.prototype.main = function () {\r\n        var self = this;\r\n\r\n        // Handle display option click.\r\n        self.rootel.on('click', '.display-options a', function(e) {\r\n            e.preventDefault();\r\n            var button = $(this);\r\n            self.display(button);\r\n        });\r\n\r\n        // Handle search result click.\r\n        self.rootel.on('click', '.recipient-result', function(e) {\r\n            e.preventDefault();\r\n            var tag = $(this);\r\n            window.location.href = tag.data('timelineurl');\r\n        });\r\n\r\n        // Handle reply click.\r\n        self.rootel.on('click', '.link-reply', function(e) {\r\n            e.preventDefault();\r\n            var button = $(this);\r\n            self.expandReply(button);\r\n        });\r\n\r\n        // Handle post reply click.\r\n        self.rootel.on('click', '.link-post-reply', function(e) {\r\n            e.preventDefault();\r\n            var button = $(this);\r\n            self.postReply(button);\r\n        });\r\n\r\n        // Handle cancel post reply click.\r\n        self.rootel.on('click', '.link-post-cancel', function(e) {\r\n            e.preventDefault();\r\n            var button = $(this);\r\n            self.cancelReply(button);\r\n        });\r\n\r\n        // Handle reply to thread.\r\n        self.rootel.on('click', '.thread-reply', function(e) {\r\n            e.preventDefault();\r\n            var reply = $(this).closest('.reply');\r\n            reply.addClass('replying');\r\n            reply.find('.reply-comment').focus();\r\n        });\r\n\r\n        // Handle post thread reply click.\r\n        self.rootel.on('click', '.post-thread-reply', function(e) {\r\n            e.preventDefault();\r\n            var button = $(this);\r\n            self.postThreadReply(button);\r\n        });\r\n\r\n        // Handle slider thumbnail click.\r\n        //self.rootel.on('click', '.slide-trigger[data-isimage=\"1\"], .slide-trigger[data-isvideo=\"1\"]', function(e) {\r\n        self.rootel.on('click', '.slide-trigger', function(e) {\r\n            e.preventDefault();\r\n            var button = $(this);\r\n            self.displaySlide(button);\r\n        });\r\n\r\n        // Handle slider nav.\r\n        self.rootel.on('click', '.slider .nav', function(e) {\r\n            e.preventDefault();\r\n            e.stopPropagation();\r\n            var button = $(this);\r\n            self.navSlider(button);\r\n        });\r\n\r\n        // Handle slider/close click.\r\n        self.rootel.on('click', '.slider', function(e) {\r\n            e.preventDefault();\r\n            var slider = $(this);\r\n            self.closeSlider(slider);\r\n        });\r\n\r\n        // Handle delete reply.\r\n        self.rootel.on('click', '.delete-post', function(e) {\r\n            e.preventDefault();\r\n            var button = $(this);\r\n            self.delete(button);\r\n        });\r\n\r\n        // Handle delete reply.\r\n        self.rootel.on('click', '.delete-reply', function(e) {\r\n            e.preventDefault();\r\n            var button = $(this);\r\n            self.deleteReply(button);\r\n        });\r\n\r\n        // Handle expand recipients.\r\n        self.rootel.on('click', '.expand-recipients', function(e) {\r\n            e.preventDefault();\r\n            var button = $(this);\r\n            self.expandRecipients(button);\r\n        });\r\n\r\n        // Open reply-to selector\r\n        self.rootel.on('click', '.reply-to-selector', function(e) {\r\n            e.preventDefault();\r\n            var button = $(this);\r\n            self.showReplyToRecipients(button);\r\n        });\r\n\r\n        // Change the reply-to user\r\n        self.rootel.on('click', '.reply-to-recipient', function(e) {\r\n            e.preventDefault();\r\n            var button = $(this);\r\n            self.changeReplyToRecipient(button);\r\n        });\r\n\r\n        // Expand conversation\r\n        self.rootel.on('click', '.conversation', function(e) {\r\n            e.preventDefault();\r\n            var button = $(this);\r\n            self.showConversation(button);\r\n        });\r\n\r\n        // Handle export.\r\n        self.rootel.on('click', '.btn-export', function(e) {\r\n            e.preventDefault();\r\n            self.export();\r\n        });\r\n\r\n        // Handle download export.\r\n        $('.path-local-psgrading').on('click', '.download-export-link ', function(e) {\r\n            self.modals.EXPORTRESULT.getModal();\r\n            self.modals.EXPORTRESULT.hide();\r\n        });\r\n\r\n        // set up infinite scroll\r\n        if(typeof InfiniteScroll != 'undefined') {\r\n            var infScroll = new InfiniteScroll( '.mod_psgrading .list', {\r\n                // options\r\n                path: '.next',\r\n                append: '.post',\r\n                history: false,\r\n                status: '.page-load-status',\r\n            });\r\n        }\r\n\r\n        // Initialise the recipient selector.\r\n        var types = ['user', 'board'];\r\n        var roles = ['student', 'staff'];\r\n        RecipientSelector.init(types, roles);\r\n\r\n        // Add completed class.\r\n        self.rootel.removeClass('loadingjs');\r\n\r\n        // Preload the modals and templates.\r\n        var preloads = [];\r\n        preloads.push(self.loadModal('EXPORTRESULT', 'Export to zip', '', ModalFactory.types.DEFAULT));\r\n        $.when.apply($, preloads).then(function() {\r\n            self.rootel.addClass('preloads-completed');\r\n        });\r\n\r\n    };\r\n\r\n    /**\r\n     * Set display option\r\n     *\r\n     * @method display\r\n     */\r\n    Timeline.prototype.display = function (button) {\r\n        var self = this;\r\n\r\n        var display = button.data('option');\r\n        self.rootel.removeClass(function (index, className) {\r\n            return (className.match (/(^|\\s)display-\\S+/g) || []).join(' ');\r\n        }).addClass(display);\r\n    };\r\n\r\n\r\n    /**\r\n     * Post reply\r\n     *\r\n     * @method postReply\r\n     */\r\n    Timeline.prototype.postReply = function (button) {\r\n        var self = this;\r\n\r\n        var post = button.closest('.post');\r\n        var comment = post.find('.reply-comment');\r\n\r\n        if (comment.val().trim().length == 0) {\r\n            return;\r\n        }\r\n\r\n        var postid = post.data('id');\r\n        var postsusersid = post.data('postsusersid');\r\n        if (postsusersid == 0) {\r\n            var replytoselected = post.find('.reply-to-selected');\r\n            if (replytoselected.length) {\r\n                postsusersid = replytoselected.attr('data-replyto');\r\n            }\r\n        }\r\n\r\n        post.removeClass('replying');\r\n        post.addClass('submitting-reply');\r\n      \r\n        Ajax.call([{\r\n            methodname: 'mod_psgrading_post_reply',\r\n            args: { \r\n                postid: postid,\r\n                postsusersid: postsusersid,\r\n                comment: comment.val(),\r\n            },\r\n            done: function(response) {\r\n                post.removeClass('submitting-reply');\r\n                comment.val('');\r\n                self.loadReplies(postid, postsusersid, response);\r\n            },\r\n            fail: function(reason) {\r\n                post.removeClass('submitting-reply');\r\n                Log.error('mod_psgrading/timeline: failed to post a reply.');\r\n                Log.debug(reason);\r\n            }\r\n        }]);\r\n    };\r\n\r\n    /**\r\n     * Cancel reply\r\n     *\r\n     * @method cancelReply\r\n     */\r\n    Timeline.prototype.cancelReply = function (button) {\r\n        var self = this;\r\n\r\n        var post = button.closest('.post');\r\n        var comment = post.find('.reply-comment');\r\n        var dropdown = post.find('.reply-to-dropdown');\r\n        \r\n        post.removeClass('replying');\r\n        comment.val('');\r\n        dropdown.hide();\r\n    };\r\n\r\n    /**\r\n     * Post thread reply\r\n     *\r\n     * @method postReply\r\n     */\r\n    Timeline.prototype.postThreadReply = function (button) {\r\n        var self = this;\r\n\r\n        var post = button.closest('.post');\r\n        var postid = post.data('id');\r\n        var reply = button.closest('.reply');\r\n        var postsusersid = post.data('postsusersid');\r\n        var comment = reply.find('.reply-comment');\r\n\r\n        if (comment.val().trim().length == 0) {\r\n            return;\r\n        }\r\n\r\n        reply.removeClass('replying');\r\n        post.addClass('submitting-reply');\r\n      \r\n        Ajax.call([{\r\n            methodname: 'mod_psgrading_post_thread_reply',\r\n            args: { \r\n                postid: postid,\r\n                postsusersid: postsusersid,\r\n                replyid: reply.data('id'),\r\n                comment: comment.val(),\r\n            },\r\n            done: function(response) {\r\n                post.removeClass('submitting-reply');\r\n                comment.val('');\r\n                self.loadReplies(postid, postsusersid, response);\r\n\r\n            },\r\n            fail: function(reason) {\r\n                post.removeClass('submitting-reply');\r\n                Log.error('mod_psgrading/timeline: failed to post a thread reply.');\r\n                Log.debug(reason);\r\n            }\r\n        }]);\r\n    };\r\n\r\n    /**\r\n     * Load replies for a post\r\n     *\r\n     * @method postReply\r\n     */\r\n    Timeline.prototype.loadReplies = function (postid, postsusersid, justcreated) {\r\n        var self = this;\r\n\r\n        var post = self.rootel.find('.post[data-id=\"' + postid + '\"]').first();\r\n\r\n        if (!post.length) {\r\n            Log.error('mod_psgrading/timeline.loadReplies: element .post[data-id=' + postid + '] not found.');\r\n            return;\r\n        }\r\n\r\n        var replies = post.find('.post-replies');\r\n        post.addClass('loading-replies');\r\n      \r\n        Ajax.call([{\r\n            methodname: 'mod_psgrading_load_replies',\r\n            args: { \r\n                postid: postid,\r\n                postsusersid: postsusersid,\r\n                timelineuser: self.rootel.data('timelineuser'),\r\n            },\r\n            done: function(response) {\r\n                // Replace replies.\r\n                replies.replaceWith(response.html).hide();\r\n                var reply = post.find('.reply[data-id=\"' + justcreated + '\"]').first();\r\n\r\n                // If there are multiple users for this post, we need to check for conversations.\r\n                if (post.hasClass('has-multiple')) {\r\n                    // Select the relevant conversation based on the reply, and highlight the reply.\r\n                    var username = reply.attr('data-conversationusername');\r\n                    var conversation = post.find('.conversation[data-conversationusername=\"' + username + '\"]').first();\r\n                    // Conversation already exists.\r\n                    if (conversation.length) {\r\n                        conversation.click();\r\n                        post.removeClass('loading-replies');\r\n                        reply.addClass('just-created');\r\n                    } else {\r\n                        // reload conversations.\r\n                        Ajax.call([{\r\n                            methodname: 'mod_psgrading_load_conversations',\r\n                            args: { \r\n                                postid: postid,\r\n                                timelineuser: self.rootel.data('timelineuser'),\r\n                            },\r\n                            done: function(response) {\r\n                                // Replace conversations.\r\n                                var conversations = post.find('.conversations').first();\r\n                                conversations.replaceWith(response.html);\r\n\r\n                                // Select the relevant conversation based on the reply, and highlight the reply.\r\n                                var conversation = post.find('.conversation[data-conversationusername=\"' + username + '\"]').first();\r\n                                conversation.click();\r\n                                post.removeClass('loading-replies');\r\n                                reply.addClass('just-created');\r\n                            },\r\n                            fail: function(reason) {\r\n                                post.removeClass('loading-replies');\r\n                                Log.error('mod_psgrading/timeline: failed to load replies for post id: ' + postid + ', postsusersid: ' + postsusersid);\r\n                                Log.debug(reason);\r\n                            }\r\n                        }]);\r\n                    }\r\n                } else {\r\n                    // Highlight the reply just created.\r\n                    post.removeClass('loading-replies');\r\n                    reply.addClass('just-created');\r\n                }\r\n            },\r\n            fail: function(reason) {\r\n                post.removeClass('loading-replies');\r\n                Log.error('mod_psgrading/timeline: failed to load replies for post id: ' + postid + ', postsusersid: ' + postsusersid);\r\n                Log.debug(reason);\r\n            }\r\n        }]);\r\n    };\r\n\r\n    /**\r\n     * Set display option\r\n     *\r\n     * @method display\r\n     */\r\n    Timeline.prototype.displaySlide = function (thumb) {\r\n        var self = this;\r\n\r\n        // Activate the overlay.\r\n        self.overlay.addClass('active loading');\r\n\r\n        var post = thumb.closest('.post');\r\n        var slider = post.find('.slider');\r\n\r\n        // If the slide has previously been loaded, use that.\r\n        if (slider.length) {\r\n            // Make the clicked thumb the current slide.\r\n            var slides = post.find('.slide');\r\n            slides.each(function(index) {\r\n                var slide = $(this);\r\n                slide.removeClass('current');\r\n                if (slide.data('src') == thumb.attr('href')) {\r\n                    slide.addClass('current');\r\n                }\r\n            });\r\n\r\n            // Make the slider active.\r\n            slider.addClass('active');\r\n            self.overlay.removeClass('loading');\r\n\r\n            return;\r\n        }\r\n\r\n        // Existing slider does not exist.\r\n        // Set up the slider based on the thumbnails.\r\n        var current = thumb.attr('href');\r\n        var slides = [];\r\n        var images = post.find('.slide-trigger');\r\n        var i = 1;\r\n        images.each(function(index) {\r\n            var src = $(this).attr('href');\r\n            var isimage = $(this).data('isimage') || 0;\r\n            var isvideo = $(this).data('isvideo') || 0;\r\n            var isdoc = $(this).data('isdoc') || 0;\r\n            var iconimage = $(this).data('iconimage') || '';\r\n            var filename = $(this).data('filename') || '';\r\n            var mimetype = $(this).data('mimetype') || '';\r\n            var iscurrent = false;\r\n            if (src == current) {\r\n                iscurrent = true;\r\n            }\r\n            slides.push({\r\n                'id': i,\r\n                'src': src,\r\n                'iscurrent': iscurrent,\r\n                'isimage': isimage,\r\n                'isvideo': isvideo,\r\n                'isdoc': isdoc,\r\n                'iconimage': iconimage,\r\n                'filename': filename,\r\n                'mimetype': mimetype,\r\n            });\r\n            i++;\r\n        });\r\n\r\n        var data = {\r\n            count: images.length,\r\n            slides: slides,\r\n        };\r\n\r\n        // Render the slider from template and add it to the dom.\r\n        Templates.render(self.templates.SLIDER, data)\r\n            .done(function(html) {\r\n                post.append(html);\r\n                self.overlay.removeClass('loading');\r\n            })\r\n            .fail(function(reason) {\r\n                Log.debug(reason);\r\n            });\r\n\r\n    };\r\n\r\n    /**\r\n     * Set display option\r\n     *\r\n     * @method display\r\n     */\r\n    Timeline.prototype.closeSlider = function (slider) {\r\n        var self = this;\r\n\r\n        // Deactivate the slider.\r\n        slider.removeClass('active');\r\n\r\n        // Deactivate the overlay.\r\n        self.overlay.removeClass('active');\r\n    };\r\n\r\n    /**\r\n     * Set display option\r\n     *\r\n     * @method display\r\n     */\r\n    Timeline.prototype.navSlider = function (button) {\r\n        var self = this;\r\n\r\n        // Get the new slide id.\r\n        var slider = button.closest('.slider');\r\n        var direction = button.data('nav');\r\n        var current = slider.find('.slide.current');\r\n        var currentid = current.data('id');\r\n        var newid = currentid + direction;\r\n\r\n        // Loop around.\r\n        if (newid > slider.data('count')) {\r\n            newid = 1;\r\n        }\r\n\r\n        if (newid == 0) {\r\n            newid = slider.data('count');\r\n        }\r\n\r\n        // Change the slide.\r\n        var newslide = slider.find('.slide[data-id=\"' + newid + '\"]');\r\n        if (newslide.length) {\r\n            current.removeClass('current');\r\n            newslide.addClass('current');\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Approve a post.\r\n     *\r\n     * @method approve\r\n     */\r\n    Timeline.prototype.approve = function (button) {\r\n        var self = this;\r\n\r\n        var post = button.closest('.post');\r\n        var id = post.data('id');\r\n        post.addClass('submitting');\r\n      \r\n        Ajax.call([{\r\n            methodname: 'mod_psgrading_approve_post',\r\n            args: { id: id },\r\n            done: function(response) {\r\n                post.removeClass('submitting');\r\n                post.removeClass('unapproved');\r\n            },\r\n            fail: function(reason) {\r\n                post.removeClass('submitting');\r\n                Log.error('mod_psgrading/timeline: failed to approve the post');\r\n                Log.debug(reason);\r\n            }\r\n        }]);\r\n    };\r\n\r\n\r\n    /**\r\n     * Delete a post.\r\n     *\r\n     * @method delete\r\n     */\r\n    Timeline.prototype.delete = function (button) {\r\n        var self = this;\r\n\r\n        var post = button.closest('.post');\r\n        var id = post.data('id');\r\n        post.addClass('submitting');\r\n      \r\n        Ajax.call([{\r\n            methodname: 'mod_psgrading_delete_post',\r\n            args: { id: id },\r\n            done: function(response) {\r\n                post.removeClass('submitting');\r\n                post.addClass('removing');\r\n                post.fadeOut(1000, function() {\r\n                    post.remove();\r\n                });\r\n            },\r\n            fail: function(reason) {\r\n                post.removeClass('submitting');\r\n                Log.error('mod_psgrading/timeline: failed to delete the post ' + id);\r\n                Log.debug(reason);\r\n            }\r\n        }]);\r\n    };\r\n\r\n\r\n    /**\r\n     * Delete a reply.\r\n     *\r\n     * @method delete\r\n     */\r\n    Timeline.prototype.deleteReply = function (button) {\r\n        var self = this;\r\n\r\n        var reply = button.closest('.reply');\r\n        var id = reply.data('id');\r\n        var threadid = reply.data('poststhreadsid');\r\n        var depth = reply.data('depth');\r\n        reply.addClass('deleting');\r\n      \r\n        Ajax.call([{\r\n            methodname: 'mod_psgrading_delete_reply',\r\n            args: { id: id },\r\n            done: function(response) {\r\n                reply.removeClass('deleting');\r\n                if (depth == 0) {\r\n                    var replies = self.rootel.find('.reply[data-poststhreadsid=\"' + threadid + '\"]');\r\n                    replies.push(reply);\r\n                    replies.addClass('removing');\r\n                    replies.fadeOut(1000, function() {reply.remove();});\r\n                } else {\r\n                    reply.addClass('removing');\r\n                    reply.fadeOut(1000, function() {reply.remove();});\r\n                }\r\n            },\r\n            fail: function(reason) {\r\n                reply.removeClass('deleting');\r\n                Log.error('mod_psgrading/timeline: failed to delete the reply ' + id);\r\n                Log.debug(reason);\r\n            }\r\n        }]);\r\n    };\r\n\r\n\r\n    Timeline.prototype.expandReply = function (button) {\r\n        self = this;\r\n\r\n        var post = button.closest('.post');\r\n        post.addClass('replying');\r\n        post.find('.reply-comment').focus();\r\n\r\n        // See if a conversation has been selected.\r\n        var conversation = post.find('.conversation.active').first();\r\n        if (conversation.length) {\r\n            var replytorecipient = post.find('.reply-to-recipient[data-option=\"' + conversation.data('postsusersid') + '\"]');\r\n            replytorecipient.click();\r\n        }\r\n    };\r\n\r\n\r\n    Timeline.prototype.expandRecipients = function (button) {\r\n        var self = this;\r\n\r\n        button.hide();\r\n        var post = button.closest('.post');\r\n        var recipients = post.find('.recipients');\r\n        recipients.addClass('expanded').removeClass('collapsed');\r\n    };\r\n\r\n\r\n    Timeline.prototype.showReplyToRecipients = function (button) {\r\n        var self = this;\r\n\r\n        var dropdown = button.next();\r\n        dropdown.fadeIn(200);\r\n    };\r\n\r\n\r\n    Timeline.prototype.changeReplyToRecipient = function (button) {\r\n        var self = this;\r\n\r\n        var dropdown = button.closest('.reply-to-dropdown');\r\n        var replyto = button.closest('.reply-to');\r\n        var selected = replyto.find('.reply-to-selected');\r\n        selected.attr('data-replyto', button.data('option'));\r\n        selected.html(button.attr('title'));\r\n        dropdown.slideUp(200);\r\n    };\r\n\r\n\r\n    Timeline.prototype.showConversation = function (button) {\r\n        var self = this;\r\n\r\n        var post = button.closest('.post');\r\n        var conversationusername = button.data('conversationusername');\r\n        post.find('.conversation').removeClass('active');\r\n        button.addClass('active');\r\n        post.find('.reply').hide();\r\n        var replies = post.find(\r\n            '.reply[data-conversationusername=\"' + conversationusername + '\"], ' +\r\n           // '.reply[data-conversationusername=\"' + post.data('creator') + '\"]'\r\n            '.reply[data-toeveryone=\"1\"]'\r\n        );\r\n        var creatorreplies = post.find();\r\n        replies.fadeIn(200);\r\n        creatorreplies.fadeIn(200);\r\n        button.find('.replycount').html(replies.length);\r\n    };\r\n\r\n\r\n\r\n    /**\r\n     * Helper used to preload a modal\r\n     *\r\n     * @method loadModal\r\n     * @param {string} modalkey The property of the global modals variable\r\n     * @param {string} title The title of the modal\r\n     * @param {string} title The button text of the modal\r\n     * @return {object} jQuery promise\r\n     */\r\n    Timeline.prototype.loadModal = function (modalkey, title, buttontext, type) {\r\n        var self = this;\r\n        return ModalFactory.create({type: type}).then(function(modal) {\r\n            modal.setTitle(title);\r\n            if (buttontext) {\r\n                modal.setSaveButtonText(buttontext);\r\n            }\r\n            self.modals[modalkey] = modal;\r\n            // Preload backgrop.\r\n            modal.getBackdrop();\r\n            modal.getRoot().addClass('modal-' + modalkey);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Export timeline\r\n     *\r\n     * @method display\r\n     */\r\n    Timeline.prototype.export = function () {\r\n        var self = this;\r\n\r\n        if (!self.modals.EXPORTRESULT) {\r\n            return;\r\n        }\r\n\r\n        // Activate the overlay.\r\n        self.overlay.addClass('active loading');\r\n\r\n        Ajax.call([{\r\n            methodname: 'mod_psgrading_export',\r\n            args: {\r\n                timeline: self.rootel.data('timelineuser'),\r\n            },\r\n            done: function(response) {\r\n                \r\n                if (response.code == 'failed') {\r\n                    self.overlay.removeClass('active loading');\r\n                    Log.error('mod_psgrading/timeline: failed to export timeline: ' + response.data);\r\n                    return;\r\n                }\r\n\r\n                // Handle the various response codes.\r\n                var data = {};\r\n                if (response.code == 'existinginprogress') {\r\n                    data.existinginprogress = true;\r\n                } else if (response.code == 'existingready') {\r\n                    data.existingready = true;\r\n                    data.downloadurl = response.data;\r\n                } else if (response.code == 'ready') {\r\n                    data.ready = true;\r\n                    data.downloadurl = response.data;\r\n                }\r\n\r\n                // Render the export result details.\r\n                Templates.render(self.templates.EXPORTRESULT, data)\r\n                    .done(function(html) {\r\n                        self.modals.EXPORTRESULT.getModal();\r\n                        self.modals.EXPORTRESULT.setBody(html);\r\n                        self.modals.EXPORTRESULT.show();\r\n                        self.overlay.removeClass('active loading');\r\n                    });\r\n            },\r\n            fail: function(reason) {\r\n                self.overlay.removeClass('active loading');\r\n                Log.error('mod_psgrading/timeline: failed to export timeline: ' + self.rootel.data('timelineuser'));\r\n                Log.debug(reason);\r\n            }\r\n        }]);\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n/*\r\n        var data = {\r\n            count: images.length,\r\n            slides: slides,\r\n        };\r\n\r\n        // Render the slider from template and add it to the dom.\r\n        Templates.render(self.templates.SLIDER, data)\r\n            .done(function(html) {\r\n                post.append(html);\r\n                $('#psgrading-overlay').removeClass('loading');\r\n            })\r\n            .fail(function(reason) {\r\n                Log.debug(reason);\r\n            });\r\n*/\r\n\r\n    };\r\n\r\n    /**\r\n     * Helper used to preload a template\r\n     *\r\n     * @method loadTemplate\r\n     * @param {string} templatekey The property of the global templates variable\r\n     * @return {object} jQuery promise\r\n     */\r\n    Timeline.prototype.loadTemplate = function (templatekey) {\r\n        var self = this;\r\n        return Templates.render(self.templates[templatekey], {});\r\n    }\r\n\r\n\r\n    /**\r\n     * Helper used to preload a modal\r\n     *\r\n     * @method loadModal\r\n     * @param {string} modalkey The property of the global modals variable\r\n     * @param {string} title The title of the modal\r\n     * @param {string} title The button text of the modal\r\n     * @return {object} jQuery promise\r\n     */\r\n    Timeline.prototype.loadModal = function (modalkey, title, buttontext, type) {\r\n        var self = this;\r\n        return ModalFactory.create({type: type}).then(function(modal) {\r\n            modal.setTitle(title);\r\n            if (buttontext) {\r\n                modal.setSaveButtonText(buttontext);\r\n            }\r\n            self.modals[modalkey] = modal;\r\n            // Preload backdrop.\r\n            modal.getBackdrop();\r\n            modal.getRoot().addClass('modal-' + modalkey);\r\n        });\r\n    }\r\n\r\n    return {\r\n        init: init\r\n    };\r\n});"],"file":"timeline.min.js"}